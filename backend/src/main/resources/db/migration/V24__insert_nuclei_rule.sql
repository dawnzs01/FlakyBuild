
ALTER TABLE plugin ADD scan_type varchar(32) DEFAULT NULL COMMENT '支持的扫描引擎类型';

UPDATE plugin set scan_type = 'custodian';

INSERT INTO plugin ( id, name, icon, update_time, scan_type) VALUES ('fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 'nuclei');

INSERT INTO rule_group (`name`, `description`, `level`, `plugin_id`, `flag`) VALUES ('Nuclei 漏洞扫描', '漏洞扫描，为您提供发现可利用漏洞的一种安全检测（渗透攻击）。', '漏洞扫描', 'fit2cloud-nuclei-plugin', 1);

SELECT @groupId := LAST_INSERT_ID();

INSERT INTO `cloud_account` (`id`, `name`, `credential`, `plugin_id`, `plugin_name`, `plugin_icon`, `status`, `create_time`, `update_time`, `creator`, `regions`, `proxy_id`) VALUES ('rs124d9d-f108-3198-8198-798k9971f814', 'Nuclei 漏洞扫描', '{\"description\":\"基于模板的 nuclei 被用来发送请求给目标，有着实现零误报的优点，并且可以对已知的路径进行有效的扫描。nuclei 的主要用于在初期的探测阶段快速地对已知的且易于检测的漏洞或者 CVE 进行扫描。如果存在 WAF 的话，nuclei 使用 retryablehttp-go 库来处理各种错误，并且重新尝试攻击。\", \"targetAddress\":\"127.0.0.1\"}', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', 'VALID', concat(unix_timestamp(now()), '010'), concat(unix_timestamp(now()), '010'), 'admin', '[{\"regionId\":\"ALL\",\"regionName\":\"Nuclei 漏洞扫描\"}]', 0);

INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('3808ac89-6fb0-4953-a6f3-a464f1b603bd', 'Nuclei  Springboot Security扫描', 1, 'LowRisk', 'Nuclei  基于条件的工作流，首先尝试检测 springboot 是否在目标上运行。如果找到 springboot，则会运行它的漏洞利用列表, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: springboot-workflow\n\ninfo:\n  name: Springboot Security Checks\n  author: dwisiswant0\n\nworkflows:\n  - template: technologies/springboot-actuator.yaml\n    subtemplates:\n      - template: cves/2018/CVE-2018-1271.yaml\n      - template: cves/2018/CVE-2018-1271.yaml\n      - template: cves/2020/CVE-2020-5410.yaml\n      - template: vulnerabilities/springboot/springboot-actuators-jolokia-xxe.yaml\n      - template: vulnerabilities/springboot/springboot-h2-db-rce.yaml', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('49fb8964-15ab-45b9-864c-69b7e7cd5b71', 'Nuclei  SSH Public Key扫描', 1, 'LowRisk', 'Nuclei  SSH 公钥检测, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: ssh-private-key\n\ninfo:\n  name: SSH Private Key Detect\n  author: pd-team\n  severity: high\n\nfile:\n  - extensions:\n      - all\n    denylist:\n      - pub\n    no-recursive: true\n    max-size: 1024 # read very small chunks\n\n    matchers:\n      - type: word\n        words:\n          - \"BEGIN OPENSSH PRIVATE KEY\"\n          - \"BEGIN PRIVATE KEY\"\n          - \"BEGIN RSA PRIVATE KEY\"\n          - \"BEGIN DSA PRIVATE KEY\"\n          - \"BEGIN EC PRIVATE KEY\"\n          - \"BEGIN PGP PRIVATE KEY BLOCK\"\n          - \"ssh-rsa\"', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('5227e5cd-7e66-4f32-8515-7895fdc79535', 'Nuclei  POST threads扫描', 1, 'LowRisk', 'Nuclei  模板以 RAW 格式定义和多个 POST 请求，threads扫描, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: race-condition-testing\n\ninfo:\n  name: Race condition testing with multiple requests\n  author: pdteam\n  severity: info\n\nrequests:\n  - raw:  \n      - |\n        POST / HTTP/1.1\n        Pragma: no-cache\n        Host: {{Hostname}}\n        Cache-Control: no-cache, no-transform\n        User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0\n\n        id=1\n\n      - |\n        POST / HTTP/1.1\n        Pragma: no-cache\n        Host: {{Hostname}}\n        Cache-Control: no-cache, no-transform\n        User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0\n\n        id=2\n\n      - |\n        POST / HTTP/1.1\n        Pragma: no-cache\n        Host: {{Hostname}}\n        Cache-Control: no-cache, no-transform\n        User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0\n\n        id=3\n\n      - |\n        POST / HTTP/1.1\n        Pragma: no-cache\n        Host: {{Hostname}}\n        Cache-Control: no-cache, no-transform\n        User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0\n\n        id=4\n\n      - |\n        POST / HTTP/1.1\n        Pragma: no-cache\n        Host: {{Hostname}}\n        Cache-Control: no-cache, no-transform\n        User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0\n\n        id=5\n\n    threads: 5\n    race: true\n\n    matchers:\n      - type: status\n        status:\n          - 200', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('6bc48581-98bb-4563-9735-a505002e344f', 'Nuclei  MySQL 实例扫描', 1, 'LowRisk', 'Nuclei  启用本机密码支持的 MySQL 实例容易受到攻击, 不启动属于则合规，否则属于则\"不合规\"', 'id: mysql-native-password-bruteforce\n\ninfo:\n  name: MySQL DB with enabled native password\n  author: iamthefrogy\n  severity: info\n  tags: network,mysql,bruteforce,db\n  description: MySQL instance with enabled native password support prone vulnerable for password brute-force attack.\n\nnetwork:\n  - host:\n      - \"{{Hostname}}\"\n      - \"{{Hostname}}:3306\"\n\n    matchers:\n      - type: word\n        words:\n          - \"mysql_native_password\"', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('ae7de16c-0a39-4119-a5c0-d0916f549e95', 'Nuclei  Basic Network Request扫描', 1, 'LowRisk', 'Nuclei  模板连接到网络服务，发送一些数据并从响应中读取 4 个字节。运行匹配器以识别有效响应, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: basic-network-request\n\ninfo:\n  name: Basic Network Request\n  author: pdteam\n  severity: info\n\nnetwork:\n  - host: \n      - \"{{Hostname}}\"\n    inputs:\n      - data: \"PING\\r\\n\"\n    read-size: 4\n    matchers:\n      - type: word\n        part: data\n        words:\n          - ${{word}}', '[{\"key\":\"word\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"PONG\\\"\",\"required\":true}]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('afd0480e-651b-4229-aa68-d642e074fb59', 'Nuclei  HTTP Template扫描', 1, 'LowRisk', 'Nuclei  模板请求/URL 路径并针对响应运行多个基于 OR 的匹配器, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: http-multiple-matchers\n\ninfo:\n  name: Test HTTP Template\n  author: pdteam\n  severity: info\n\nrequests:\n  - method: GET\n    path:\n      - \"{{BaseURL}}/\"\n    matchers:\n      - type: word\n        name: php\n        words:\n          - ${{word1}}\n          - ${{word2}}\n        part: header\n\n      - type: word\n        name: node\n        words:\n          - ${{word3}}\n          - ${{word4}}\n        condition: or\n        part: header\n\n      - type: word\n        name: python\n        words:\n          - ${{word5}}\n          - ${{word6}}\n        part: header', '[{\"key\":\"word1\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"X-Powered-By: PHP\\\"\",\"required\":true},{\"key\":\"word2\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"PHPSESSID\\\"\",\"required\":true},{\"key\":\"word3\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"Server: NodeJS\\\"\",\"required\":true},{\"key\":\"word4\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"X-Powered-By: nodejs\\\"\",\"required\":true},{\"key\":\"word5\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"Python/2.\\\"\",\"required\":true},{\"key\":\"word6\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"Python/3.\\\"\",\"required\":true}]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('cfc3ad75-2599-47ab-bfb2-af8a07531250', 'Nuclei  HTTP request扫描', 1, 'LowRisk', 'Nuclei  模板使用 rawhttp 库并检查字符串是否与响应匹配来生成定义的格式错误的 HTTP POST 请求, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: CL.TE-http-smuggling\n\ninfo:\n  name: HTTP request smuggling, basic CL.TE vulnerability\n  author: pdteam\n  severity: info\n  lab: https://portswigger.net/web-security/request-smuggling/lab-basic-cl-te\n\nrequests:\n  - raw:\n    - |+\n      POST / HTTP/1.1\n      Host: {{Hostname}}\n      Connection: keep-alive\n      Content-Type: application/x-www-form-urlencoded\n      Content-Length: 6\n      Transfer-Encoding: chunked\n\n      0\n\n      G\n    - |+\n      POST / HTTP/1.1\n      Host: {{Hostname}}\n      Connection: keep-alive\n      Content-Type: application/x-www-form-urlencoded\n      Content-Length: 6\n      Transfer-Encoding: chunked\n\n      0\n\n      G\n\n    unsafe: true\n    matchers:\n      - type: dsl\n        dsl:\n          - \'contains(body, \"Unrecognized method GPOST\")\'', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('f50705c1-8930-4a53-b32d-da08eda1161c', 'Nuclei  Wordpress Security扫描', 1, 'LowRisk', 'Nuclei  模板检测 wordpress 是否在输入主机上运行，​​如果找到，则运行 wordpress 的漏洞利用和 cvs 列表, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: workflow-example\ninfo:\n  name: Test Workflow Template\n  author: pdteam\n\nworkflows:\n  - template: technologies/tech-detect.yaml\n    matchers:\n      - name: wordpress\n        subtemplates:\n          - template: cves/2019/CVE-2019-6715.yaml\n          - template: cves/2019/CVE-2019-9978.yaml\n          - template: vulnerabilities/wordpress/wordpress-db-backup.yaml\n          - template: vulnerabilities/wordpress/wordpress-debug-log.yaml\n          - template: vulnerabilities/wordpress/wordpress-directory-listing.yaml\n          - template: vulnerabilities/wordpress/wordpress-emergency-script.yaml\n          - template: vulnerabilities/wordpress/wordpress-installer-log.yaml\n          - template: vulnerabilities/wordpress/wordpress-tmm-db-migrate.yaml\n          - template: vulnerabilities/wordpress/wordpress-user-enum.yaml\n          - template: vulnerabilities/wordpress/wordpress-accessible-wpconfig.yaml\n          - template: vulnerabilities/wordpress/sassy-social-share.yaml\n          - template: vulnerabilities/wordpress/w3c-total-cache-ssrf.yaml\n          - template: vulnerabilities/wordpress/wordpress-social-metrics-tracker.yaml\n          - template: vulnerabilities/wordpress/wordpress-wordfence-xss.yaml\n          - template: vulnerabilities/wordpress/wordpress-wpcourses-info-disclosure.yaml', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('fc94e69d-a3bb-46a4-9f24-60f8369c6f15', 'Nuclei  Jira & Confluence扫描', 1, 'LowRisk', 'Nuclei  运行两个模板的通用工作流，一个用于检测 Jira，另一个用于检测 Confluence, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: workflow-example\ninfo:\n  name: Test Workflow Template\n  author: pdteam\n\nworkflows:\n  - template: exposed-panels/jira-detect.yaml\n  - template: vulnerabilities/confluence/confluence-ssrf-sharelinks.yaml', '[]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`) VALUES ('ffecf574-f388-40ad-aebb-9a46ef798dcf', 'Nuclei  DNS Template扫描', 1, 'LowRisk', 'Nuclei  检测输入是否存在 CNAME 记录的基本 DNS 请求, 无返回结果属于则合规，否则属于则\"不合规\"', 'id: multiple-matcher\n\ninfo:\n  name: Test DNS Template\n  author: pdteam\n  severity: info\n\ndns:\n  - name: \"{{FQDN}}\"\n    type: CNAME\n    class: inet\n    recursion: true\n    retries: 5\n    matchers-condition: or\n    matchers:\n      - type: word\n        name: zendesk\n        words:\n          - ${{word1}}\n      - type: word\n        name: github\n        words:\n          - ${{word2}}', '[{\"key\":\"word1\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"zendesk.com\\\"\",\"required\":true},{\"key\":\"word2\",\"name\":\"匹配器\",\"defaultValue\":\"\\\"github.io\\\"\",\"required\":true}]', 'fit2cloud-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '010'), 1, 'nuclei');


INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('6bc48581-98bb-4563-9735-a505002e344f', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('afd0480e-651b-4229-aa68-d642e074fb59', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('cfc3ad75-2599-47ab-bfb2-af8a07531250', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('5227e5cd-7e66-4f32-8515-7895fdc79535', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('ffecf574-f388-40ad-aebb-9a46ef798dcf', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('49fb8964-15ab-45b9-864c-69b7e7cd5b71', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('ae7de16c-0a39-4119-a5c0-d0916f549e95', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('fc94e69d-a3bb-46a4-9f24-60f8369c6f15', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('3808ac89-6fb0-4953-a6f3-a464f1b603bd', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('f50705c1-8930-4a53-b32d-da08eda1161c', 'safety');


INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('6bc48581-98bb-4563-9735-a505002e344f', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('afd0480e-651b-4229-aa68-d642e074fb59', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('cfc3ad75-2599-47ab-bfb2-af8a07531250', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('5227e5cd-7e66-4f32-8515-7895fdc79535', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('ffecf574-f388-40ad-aebb-9a46ef798dcf', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('49fb8964-15ab-45b9-864c-69b7e7cd5b71', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('ae7de16c-0a39-4119-a5c0-d0916f549e95', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('fc94e69d-a3bb-46a4-9f24-60f8369c6f15', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('3808ac89-6fb0-4953-a6f3-a464f1b603bd', @groupId);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('f50705c1-8930-4a53-b32d-da08eda1161c', @groupId);


INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('4d0c4031-3532-475d-a588-ac414dea9b50', 'f50705c1-8930-4a53-b32d-da08eda1161c', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('845997f4-f468-44b4-bb93-8beebdeea179', '6bc48581-98bb-4563-9735-a505002e344f', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('949c53b6-091f-4b25-90a7-92988ca1f5f7', 'afd0480e-651b-4229-aa68-d642e074fb59', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('a02692b1-75fc-4c64-8370-cb6e1c4b334a', 'fc94e69d-a3bb-46a4-9f24-60f8369c6f15', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('c3024009-4cfa-4898-ad0d-ec98f55cf295', 'ae7de16c-0a39-4119-a5c0-d0916f549e95', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('d064d46a-ec0c-4c91-876c-2e815fc15531', '49fb8964-15ab-45b9-864c-69b7e7cd5b71', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('d3c90d07-22c5-4437-8bf2-92ff7409a621', '5227e5cd-7e66-4f32-8515-7895fdc79535', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('d7d6d250-1766-49ab-8dda-d78d25328ac9', '3808ac89-6fb0-4953-a6f3-a464f1b603bd', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('ebeb6338-355e-4653-856a-b181b3c3a125', 'ffecf574-f388-40ad-aebb-9a46ef798dcf', 'nuclei');
INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('f3807c69-3ff0-4f81-a947-7b01826f55c9', 'cfc3ad75-2599-47ab-bfb2-af8a07531250', 'nuclei');
